<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quotes • EV-DMS</title>
    <link rel="stylesheet" href="/css/quotes.css">
</head>
<body>

<h1 th:text="${role == 'MANAGER' ? 'Pending Quotes (Manager Review)' : 'My Quotes'}"></h1>

<div th:if="${role == 'STAFF'}">
    <a href="/dealer/quotes/my/new">+ Create New Quote</a>
    <br><br>
</div>

<table border="1" cellpadding="8" cellspacing="0">
    <thead>
    <tr>
        <th>ID</th>
        <th>Customer</th>
        <th>Total</th>
        <th>Discount</th>
        <th>Final</th>
        <th>Status</th>
        <th>Reject Reason</th>
        <th>Action</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="q : ${quotes}">
        <td th:text="${q.id}"></td>
        <td th:text="${q.customerId}"></td>
        <td th:text="${#numbers.formatDecimal(q.totalAmount,1,2)}"></td>
        <td th:text="${#numbers.formatDecimal(q.appliedDiscount,1,2)}"></td>
        <td th:text="${#numbers.formatDecimal(q.finalAmount,1,2)}"></td>
        <td th:text="${q.status}"></td>
        <td th:text="${q.rejectComment}"></td>

        <td>
            <!-- Staff actions -->
            <form th:if="${role == 'STAFF' and q.status == 'DRAFT'}"
                  th:action="@{|/dealer/quotes/submit/${q.id}|}" method="post"
                  style="display:inline;">
                <button type="submit">Submit</button>
            </form>

            <!-- Manager actions -->
            <div th:if="${role == 'MANAGER'}">
                <form th:action="@{|/dealer/quotes/approve/${q.id}|}" method="post"
                      style="display:inline;">
                    <button type="submit">✅ Approve</button>
                </form>
                <form th:action="@{|/dealer/quotes/reject/${q.id}|}" method="post"
                      style="display:inline;">
                    <input type="text" name="comment" placeholder="Reason..." required>
                    <button type="submit">❌ Reject</button>
                </form>
            </div>
        </td>
    </tr>
    </tbody>
</table>

<br>
<a th:if="${role == 'STAFF'}" href="/dealer/dashboard">← Back to Dashboard</a>
<a th:if="${role == 'MANAGER'}" href="/dealer/dashboard">← Back to Manager Dashboard</a>

</body>
</html>
